Readme ToolsLavoro

La procedura in file index.js o index_.js fanno la stessa cosa, cioè leggono il file data_import.xlsx e creano da programma intents con nome, domande e risposte, in lingua italiana.
Index_.js è organizzato in classi ma richiede più giri di esecuzione, anche se dai test eseguiti, il tempo impiegato da ambo le procedure è lo stesso.
Chiudo qui per il momento.
Da verificare: deprecation warning grpc.load
GET https://dialogflow.googleapis.com/v2/projects/pippo-f6372/agent
api key AIzaSyDIepws4h2v4WG5JqE1OVpmya8qGLjKvwk

client secret AWeD7OKYpwKws8Pa2CBZpTil
https://cloud.google.com/dialogflow/es/docs/reference/rest/v2/projects

NB: per creare nuovo agente bisogna entrare in console di DF


API Explorer per testare gli end-points 
\projects

GET AGENT
parent: projects/ucolor-anfrsf
premi execute e vedi la response
200
{
  "parent": "projects/ucolor-anfrsf",
  "displayName": "UColor",
  "defaultLanguageCode": "it",
  "timeZone": "Europe/Kaliningrad",
  "description": "agente creato durante la sessione con WIV",
  "enableLogging": true,
  "matchMode": "MATCH_MODE_HYBRID",
  "classificationThreshold": 0.3,
  "apiVersion": "API_VERSION_V2",
  "tier": "TIER_STANDARD"
}
SET AGENT
parent: projects/ucolor-anfrsf
request body: inserisci il body sopra, modificando ad esempio la description o altri campi
200
{
  "parent": "projects/ucolor-anfrsf",
  "displayName": "UColor",
  "defaultLanguageCode": "it",
  "timeZone": "Europe/Kaliningrad",
  "description": "MODIFICATO",
  "enableLogging": true,
  "matchMode": "MATCH_MODE_HYBRID",
  "classificationThreshold": 0.3,
  "apiVersion": "API_VERSION_V2",
  "tier": "TIER_STANDARD"
}

DELETE AGENT
parent: projects/ucolor-anfrsf
body vuoto —> NON LO TESTO ORA!!
t

projects.agent
Methods
export
 Exports the specified agent to a ZIP file.
getFulfillment
 Retrieves the fulfillment.
getValidationResult
 Gets agent validation result.
import
 Imports the specified agent from a ZIP file.
restore
 Restores the specified agent from a ZIP file.
search
 Returns the list of agents.
train
 Trains the specified agent.
updateFulfillment
 Updates the fulfillment.


projects.agent.entityTypes entità
CREO UNA NUOVA ENTITA’
parent projects/ucolor-anfrsf/agent
language code it
request body 
{
  "name": "materie",
  "entities": [
    {
      "value": "informatica",
      "synonyms": [
        "inf"
      ]
    },
    {
      "value": "analisi matematica",
      "synonyms": [
        "matematica"
      ]
    }
  ]
}
ERRORE 400 (nb questo è un oggetto OPERATION)
{
  "error": {
    "code": 400,
    "message": "com.google.apps.framework.request.BadRequestException: CreateEntityTypeRequest.entity_type.name should be empty. It will be generated by the server upon creation.",
    "status": "INVALID_ARGUMENT"
  }
}


ora ok 200
{
  "name": "projects/ucolor-anfrsf/agent/entityTypes/93afdfaf-3bde-4e29-b32a-a01dc5222423",
  "displayName": "materia",
  "kind": "KIND_LIST",
  "entities": [
    {
      "value": "informatica",
      "synonyms": [
        "informatica"
      ]
    },
    {
      "value": "analisi matematica",
      "synonyms": [
        "analisi matematica"
      ]
    }
  ]
}


PATCH DELLA ENTITA’ CREATA (EDIT)
projects/ucolor-anfrsf/agent/entityTypes/93afdfaf-3bde-4e29-b32a-a01dc5222423
aggingo altre materie
200 ok 
{
  "name": "projects/ucolor-anfrsf/agent/entityTypes/93afdfaf-3bde-4e29-b32a-a01dc5222423",
  "displayName": "materia",
  "kind": "KIND_LIST",
  "entities": [
    {
      "value": "informatica",
      "synonyms": [
        "informatica"
      ]
    },
    {
      "value": "analisi matematica",
      "synonyms": [
        "analisi matematica"
      ]
    },
    {
      "value": "geometria analitica",
      "synonyms": [
        "geometria analitica"
      ]
    },
    {
      "value": "economia aziendale",
      "synonyms": [
        "economia aziendale"
      ]
    }
  ]
}

list di tutte le entità (elenco di tutte le entità)
parent projects/ucolor-anfrsf/agent
200 
{
  "entityTypes": [
    {
      "name": "projects/ucolor-anfrsf/agent/entityTypes/3ce0e141-1df4-47ec-ba97-e4632d31506f",
      "displayName": "skin_tone",
      "kind": "KIND_MAP",
      "entities": [
        {
          "value": "chiara",
          "synonyms": [
            "chiara",
            "bianca",
            "pallida"
          ]
        },
        {
          "value": "scura",
          "synonyms": [
            "scura",
            "olivastra",
            "abbronzata"
          ]
        }
      ]
    },
    {
      "name": "projects/ucolor-anfrsf/agent/entityTypes/93afdfaf-3bde-4e29-b32a-a01dc5222423",
      "displayName": "materia",
      "kind": "KIND_LIST",
      "entities": [
        {
          "value": "informatica",
          "synonyms": [
            "informatica"
          ]
        },
        {
          "value": "analisi matematica",
          "synonyms": [
            "analisi matematica"
          ]
        },
        {
          "value": "geometria analitica",
          "synonyms": [
            "geometria analitica"
          ]
        },
        {
          "value": "economia aziendale",
          "synonyms": [
            "economia aziendale"
          ]
        },
        {
          "value": "inserita manuale",
          "synonyms": [
            "inserita manuale"
          ]
        }
      ]
    },
    {
      "name": "projects/ucolor-anfrsf/agent/entityTypes/ac001406-b387-476d-b95d-e98e8221f88f",
      "displayName": "hair_color",
      "kind": "KIND_MAP",
      "entities": [
        {
          "value": "biondi",
          "synonyms": [
            "biondi",
            "gialli"
          ]
        },
        {
          "value": "castani",
          "synonyms": [
            "castani",
            "mogano",
            "castano scuro"
          ]
        },
        {
          "value": "rossi",
          "synonyms": [
            "rossi"
          ]
        },
        {
          "value": "neri",
          "synonyms": [
            "neri",
            "corvini"
          ]
        },
        {
          "value": "grigi",
          "synonyms": [
            "grigi",
            "bianchi"
          ]
        },
        {
          "value": "calvo",
          "synonyms": [
            "calvo",
            "senza capelli",
            "non ne ho"
          ]
        }
      ]
    },
    {
      "name": "projects/ucolor-anfrsf/agent/entityTypes/cef0212f-fec6-4ad9-b158-df99e1967edd",
      "displayName": "eye_color",
      "kind": "KIND_MAP",
      "entities": [
        {
          "value": "azzurri",
          "synonyms": [
            "azzurri, blu, grigi"
          ]
        },
        {
          "value": "marroni",
          "synonyms": [
            "marroni",
            "castani"
          ]
        },
        {
          "value": "verdi",
          "synonyms": [
            "verdi"
          ]
        },
        {
          "value": "neri",
          "synonyms": [
            "neri"
          ]
        }
      ]
    }
  ]
}


GET SINGOLA ENTITA’
parent projects/ucolor-anfrsf/agent/entityTypes/cef0212f-fec6-4ad9-b158-df99e1967edd
200 ok
{
  "name": "projects/ucolor-anfrsf/agent/entityTypes/cef0212f-fec6-4ad9-b158-df99e1967edd",
  "displayName": "eye_color",
  "kind": "KIND_MAP",
  "entities": [
    {
      "value": "azzurri",
      "synonyms": [
        "azzurri, blu, grigi"
      ]
    },
    {
      "value": "marroni",
      "synonyms": [
        "marroni",
        "castani"
      ]
    },
    {
      "value": "verdi",
      "synonyms": [
        "verdi"
      ]
    },
    {
      "value": "neri",
      "synonyms": [
        "neri"
      ]
    }
  ]
}

delete non lo faccio ora

(batchDelete e batchUpdate entities)

INTENTS
Methods
batchDelete
	Deletes intents in the specified agent.
batchUpdate
	Updates/Creates multiple intents in the specified agent.
create
	Creates an intent in the specified agent.
delete
	Deletes the specified intent and its direct or indirect followup intents.
get
	Retrieves the specified intent.
list
	Returns the list of all intents in the specified agent.
patch
	Updates the specified intent.


projects.agent.sessions
Methods
deleteContexts (cancella i contesti attivi)
	Deletes all active contexts in the specified session.
detectIntent
	Processes a natural language query and returns structured, actionable data as a result.
Processes a natural language query and returns structured, actionable data as a result. This method is not idempotent, because it may cause contexts and session entity types to be updated, which in turn might affect results of future queries


 projects.agent.sessions.contexts CONTESTI
create
	Creates a context.
delete
	Deletes the specified context.
get
	Retrieves the specified context.
list
	Returns the list of all contexts in the specified session.
patch
	Updates the specified context.

projects.agent.sessions.entityTypes SESSION ENTITY TYPE
A session represents a conversation between a Dialogflow agent and an end-user. You can create special entities, called session entities, during a session. Session entities can extend or replace custom entity types and only exist during the session that they were created for. All session data, including session entities, is stored by Dialogflow for 20 minutes.
create
	Creates a session entity type.
delete
	Deletes the specified session entity type.
get
	Retrieves the specified session entity type.
list
	Returns the list of all session entity types in the specified session.
patch
	Updates the specified session entity type.


GET https://dialogflow.googleapis.com/v2/{parent=projects/*/agent}/intents



PER CREARE PROGETTO DA ACTION CONSOLE
OK 200

curl --request POST \
  'https://cloudresourcemanager.googleapis.com/v1/projects?key=[YOUR_API_KEY]' \
  --header 'Authorization: Bearer [YOUR_ACCESS_TOKEN]' \
  --header 'Accept: application/json' \
  --header 'Content-Type: application/json' \
  --data '{"projectId":"provavalerest","name":"provavalerest"}' \
  --compressed

RESPONSE
{
  "name": "operations/cp.8492042042443136326"
}


JAVASCRIPT 
<script src="https://apis.google.com/js/api.js"></script>
<script>
  /**
   * Sample JavaScript code for cloudresourcemanager.projects.create
   * See instructions for running APIs Explorer code samples locally:
   * https://developers.google.com/explorer-help/guides/code_samples#javascript
   */

  function authenticate() {
    return gapi.auth2.getAuthInstance()
        .signIn({scope: "https://www.googleapis.com/auth/cloud-platform"})
        .then(function() { console.log("Sign-in successful"); },
              function(err) { console.error("Error signing in", err); });
  }
  function loadClient() {
    gapi.client.setApiKey("YOUR_API_KEY");
    return gapi.client.load("https://cloudresourcemanager.googleapis.com/$discovery/rest?version=v1")
        .then(function() { console.log("GAPI client loaded for API"); },
              function(err) { console.error("Error loading GAPI client for API", err); });
  }
  // Make sure the client is loaded and sign-in is complete before calling this method.
  function execute() {
    return gapi.client.cloudresourcemanager.projects.create({
      "resource": {
        "projectId": "provavalerest",
        "name": "provavalerest"
      }
    })
        .then(function(response) {
                // Handle the results here (response.result has the parsed body).
                console.log("Response", response);
              },
              function(err) { console.error("Execute error", err); });
  }
  gapi.load("client:auth2", function() {
    gapi.auth2.init({client_id: "YOUR_CLIENT_ID"});
  });
</script>
<button onclick="authenticate().then(loadClient)">authorize and load</button>
<button onclick="execute()">execute</button>

HTTP
POST https://cloudresourcemanager.googleapis.com/v1/projects?key=[YOUR_API_KEY] HTTP/1.1

Authorization: Bearer [YOUR_ACCESS_TOKEN]
Accept: application/json
Content-Type: application/json

{
  "projectId": "provavalerest",
  "name": "provavalerest"
}

ok funziona create e delete 



QUESTO E’ CURL CHE VEDO DALLA CONSOLE DIALOGFLOW DI PIPPO ATTIVANDO UN INTENT QUALSIASI

curl -H "Content-Type: application/json; charset=utf-8"  -H "Authorization: Bearer ya29.a0AfH6SMAu_-3-RCR1J7orcBv8jAEHNPzaT8DbkGKavat4CFwZny3KhX0WB5FuABlDTazwdeF_baVnzU_tkD2spMQ0PomQaMAKs3RxB5KmnO3Iy0gq6ATBePDFD1PCROXfKKVfCTyFILyFK2MO3TOg-QABxX755kly7SDDcuE9ytceS0Q-6XCVlg"  -d "{\"queryInput\":{\"text\":{\"text\":\"che cosa è app vocale\",\"languageCode\":\"en\"}},\"queryParams\":{\"source\":\"DIALOGFLOW_CONSOLE\",\"timeZone\":\"Europe/Rome\"}}" "https://dialogflow.clients6.google.com/v2/projects/pippo-f6372/agent/sessions/7dd80610-08f3-910a-c20b-ef34ef63835e:detectIntent"


PROVO A METTERE QUESTO TOKEN NEL CODICE DI ESEMPIO OTTENUTO DA API EXPLORER

curl \
  'https://dialogflow.googleapis.com/v2/projects/pippo-f6372/agent?key=AIzaSyAT5kgawymGJOneFMq6wGgNtnide1IVQYw' \
  --header 'Accept: application/json' \
  --compressed

MA NON FUNZIONA 
  "error": {
    "code": 400,
    "message": "The API Key and the authentication credential are from different projects.",
    "status": "INVALID_ARGUMENT",
    "details": [
      {
        "@type": "type.googleapis.com/google.rpc.Help",
        "links": [
          {
            "description": "Google developer console API key",
            "url": "https://console.developers.google.com/project/222699672466/apiui/credential"
          }
        ]
      }
    ]
  }
}